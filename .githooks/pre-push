#!/usr/bin/env bash
set -euo pipefail

# ---------- JDK ê²½ë¡œ ë³´ì • (í•„ìš” ì‹œ ìˆ˜ì •) ----------
if [[ -n "${JAVA_HOME:-}" ]]; then
  echo "âœ“ Using JAVA_HOME from system: $JAVA_HOME" >&2
  # JAVA_HOME/bin ì´ PATHì— ì—†ë‹¤ë©´ ì¶”ê°€ (ì¤‘ë³µ ì¶”ê°€ ë°©ì§€)
  case ":$PATH:" in
    *":$JAVA_HOME/bin:"*) ;;
    *) export PATH="$JAVA_HOME/bin:$PATH" ;;
  esac
elif command -v java >/dev/null 2>&1; then
  echo "âœ“ Using 'java' from PATH: $(command -v java)" >&2
else
  echo "âœ— Java not found. Please set JAVA_HOME as a system environment variable (or add java to PATH)." >&2
  echo "   ì˜ˆ) Windows(ì‹œìŠ¤í…œ í™˜ê²½ë³€ìˆ˜): JAVA_HOME=C:\\Program Files\\Java\\jdk-21" >&2
  echo "       macOS/Linux(shell ì„¤ì •): export JAVA_HOME=\$(/usr/libexec/java_home -v 21) && export PATH=\"\$JAVA_HOME/bin:\$PATH\"" >&2
  exit 1
fi

# ë™ìž‘ í™•ì¸
java -version >&2
# -----------------------------------------------

echo "ðŸ”Ž Verifying code style before push (spotless + checkstyle)..." >&2

# Windows/Unix ëª¨ë‘ ë™ìž‘í•˜ë„ë¡ gradle wrapper í˜¸ì¶œ
if [ -f "./gradlew" ]; then
  ./gradlew --no-daemon -q spotlessCheck checkstyleMain
else
  cmd /c "gradlew.bat --no-daemon -q spotlessCheck checkstyleMain"
fi

echo "âœ… Style checks passed. Proceeding with push." >&2
