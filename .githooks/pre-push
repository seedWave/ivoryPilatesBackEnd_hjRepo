#!/usr/bin/env bash
set -euo pipefail

# ---------- JDK ê²½ë¡œ ë³´ì • (í•„ìš” ì‹œ ìˆ˜ì •) ----------
if [ -z "${JAVA_HOME:-}" ]; then
  # 1) IntelliJ ë²ˆë“¤ JBR ìš°ì„ 
  if [ -d "/c/Program Files/JetBrains/IntelliJ IDEA 2024.3.5/jbr" ]; then
    export JAVA_HOME="/c/Program Files/JetBrains/IntelliJ IDEA 2024.3.5/jbr"
  # 2) ì¼ë°˜ JDK (ì˜ˆì‹œ ê²½ë¡œ, í™˜ê²½ì— ë§žê²Œ ë°”ê¾¸ì„¸ìš”)
  elif [ -d "/c/Program Files/Java/jdk-21" ]; then
    export JAVA_HOME="/c/Program Files/Java/jdk-21"
  fi
  export PATH="$JAVA_HOME/bin:$PATH"
fi
# -----------------------------------------------

echo "ðŸ”Ž Verifying code style before push (spotless + checkstyle)..." >&2

# Windows/Unix ëª¨ë‘ ë™ìž‘í•˜ë„ë¡ gradle wrapper í˜¸ì¶œ
if [ -f "./gradlew" ]; then
  ./gradlew --no-daemon -q spotlessCheck checkstyleMain
else
  cmd /c "gradlew.bat --no-daemon -q spotlessCheck checkstyleMain"
fi

echo "âœ… Style checks passed. Proceeding with push." >&2
